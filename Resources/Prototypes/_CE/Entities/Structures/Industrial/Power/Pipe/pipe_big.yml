- type: entity
  id: CEPipeBrassBigBase
  parent:
  - BaseStructure
  - CEPipeBase
  description: Insulated brass pipe with iron supports. A standardized method of transmitting arcane energy over long distances. However, any holes or cracks can lead to energy leakage and harm to surrounding creatures susceptible to magic.
  abstract: true
  categories: [ ForkFiltered ]
  placement:
    mode: SnapgridCenter
  components:
  - type: PlacementReplacement
    key: pipe_big
  - type: CEPipeVisualizer
    statePrefix: pipe_

- type: entity
  id: CEPipeBrassBig
  parent: CEPipeBrassBigBase
  name: brass pipe
  components:
  - type: Sprite
    sprite: _CE/Structures/Industrial/Power/Pipes/big_flat.rsi
    state: pipe_15
    drawdepth: Mobs
    offset: 0, 0.01
  - type: Icon
    sprite: _CE/Structures/Industrial/Power/Pipes/big_flat.rsi
    state: pipe_15
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.3,-0.3,0.3,0.3"
        density: 55
        mask:
        - TableMask
        layer:
        - TableLayer
  - type: Climbable
    delay: 0.5
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 25
      behaviors:
      - !type:SpawnEntitiesBehavior
        spawn:
          CEBrassScrap1:
            min: 1
            max: 1
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
      - !type:ChangeConstructionNodeBehavior
        node: CEPipeBrassBigBroken
  - type: NodeContainer
    nodes:
      power:
        !type:CableNode
        nodeGroupID: HVPower
  - type: Construction
    graph: CEPipeBrassBig
    node: CEPipeBrassBig

- type: entity
  parent: CEPipeBrassBig
  id: CEPipeBrassBigVerticalUp
  name: brass pipe up
  components:
  - type: Sprite
    sprite: _CE/Structures/Industrial/Power/Pipes/big_up.rsi
  - type: Icon
    sprite: _CE/Structures/Industrial/Power/Pipes/big_up.rsi
  - type: NodeContainer
    nodes:
      power:
        !type:CableNode
        nodeGroupID: HVPower
      power_vertical:
        !type:CECableVerticalNode
        up: true
        nodeGroupID: HVPower
  - type: Construction
    graph: CEPipeBrassBig
    node: CEPipeBrassBigVerticalUp

- type: entity
  parent: CEPipeBrassBig
  id: CEPipeBrassBigVerticalDown
  name: brass pipe down
  components:
  - type: Sprite
    sprite: _CE/Structures/Industrial/Power/Pipes/big_down.rsi
  - type: Icon
    sprite: _CE/Structures/Industrial/Power/Pipes/big_down.rsi
  - type: NodeContainer
    nodes:
      power:
        !type:CableNode
        nodeGroupID: HVPower
      power_vertical:
        !type:CECableVerticalNode
        down: true
        nodeGroupID: HVPower
  - type: Construction
    graph: CEPipeBrassBig
    node: CEPipeBrassBigVerticalDown

# Valve

- type: entity
  id: CEPipeBrassBigValve
  parent: CEPipeBrassBig
  name: pipe valve
  description: A valve installed on a brass pipe, allowing for the regulation of arcane energy flow through the pipe.
  suffix: Valve, Off
  components:
  - type: InteractionOutline
  - type: CEToggleableCable
    active: false
  - type: Sprite
    layers:
    - state: pipe_15
    - state: valve_off
      map: ["valve"]
    - state: valve_off_light
      shader: unshaded
      map: ["valve_light"]
  - type: NodeContainer
    nodes:
      power:
        !type:CableNode
        nodeGroupID: HVPower
        active: false
  - type: UseDelay
  - type: GenericVisualizer
    visuals:
      enum.CEToggleableCableVisuals.Enabled:
        valve_light:
          True: {state: valve_on_light}
          False: {state: valve_off_light}
        valve:
          True: {state: valve_on}
          False: {state: valve_off}
  - type: EmitSoundOnActivate
    sound: /Audio/Effects/toss.ogg
  - type: Construction
    graph: CEPipeBrassBig
    node: CEPipeBrassBigValve
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 25
      behaviors:
      - !type:SpawnEntitiesBehavior
        spawn:
          CEBrassScrap1:
            min: 1
            max: 1
          CEIronScrap1:
            min: 1
            max: 1
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
      - !type:ChangeConstructionNodeBehavior
        node: CEPipeBrassBigBroken

- type: entity
  id: CEPipeBrassBigValveOn
  parent: CEPipeBrassBigValve
  suffix: Valve, On
  components:
  - type: CEToggleableCable
    active: true
  - type: Sprite
    layers:
    - state: pipe_15
    - state: valve_on
      map: ["valve"]
    - state: valve_on_light
      shader: unshaded
      map: ["valve_light"]
  - type: NodeContainer
    nodes:
      power:
        !type:CableNode
        nodeGroupID: HVPower
        active: true

# Broken

- type: entity
  id: CEPipeBrassBigBroken
  parent: CEPipeBrassBig
  categories: [ ForkFiltered ]
  description: Damaged brass pipe. The arcane energy flowing through them will flow here and may pose a serious danger to creatures susceptible to magic.
  suffix: Broken
  components:
  - type: Sprite
    layers:
    - state: broken_pipe_15
    - state: electrified
      shader: unshaded
      visible: false
      map: [ sparkle ]
  - type: GenericVisualizer
    visuals:
      enum.CEPowerConsumerVisuals.Active:
        sparkle:
          True: {visible: true}
          False: {visible: false}
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:SpawnEntitiesBehavior
        spawn:
          CEBrassScrap1:
            min: 1
            max: 1
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: PowerConsumer
    voltage: High
    drawRate: 5
  - type: RadiationSource
    intensity: 0
  - type: CEEnergyLeak
  - type: PointLight
    radius: 3.5
    energy: 2
    color: "#309fdf"
    enabled: false
  - type: LightBehaviour
    behaviours:
    - !type:RandomizeBehaviour
      interpolate: Nearest
      minDuration: 0.02
      maxDuration: 0.06
      startValue: 0.0
      endValue: 3.0
      property: Energy
      isLooped: true
      enabled: false
  - type: Construction
    graph: CEPipeBrassBig
    node: CEPipeBrassBigBroken
    defaultTarget: CEPipeBrassBig
  - type: CEPipeVisualizer
    statePrefix: broken_pipe_
